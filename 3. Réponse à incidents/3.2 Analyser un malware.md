
## 1.  Contexte

Un fichier critique permettant de renouveler la certification d'un diplôme a été chiffré. En effet, depuis quelques jours les attaques de ransomware semblent cibler particulièrement les secteurs liés à l’éducation.

## 2.  Méthodologie

### 1.   Chaine de custody 

|   |   |
|---|---|
|**Elément**|**HASH MD5**|
|ZIP contenant les éléments ci-dessous (infected.zip)|0c11d4d6a6eaa801aca427cacafb8400|
|Dump mémoire (dump.raw)|7708f8b427f3f4399d76e4fbdc5dffc7|
|secret.zip.encrypted (fichier chiffré)|db5c3c3b82e431bb16a3dc13facc82a2|
|Capture réseau (capture.pcapng)|2d63728280a0e4a95f46f68d21f3bdd9|

## 3.  IOC identifiés

|   |   |   |
|---|---|---|
|**TYPE**|**IOC**|**HASH MD5**|
|Executable|Svchost.exe|9b0ba3738c994d5850d97077d578d3bc|
|URL|http://esdcybersecurityacademi.fr/svchost.exe||
|URL|https://pastebin.com/raw/DY2WgpGe||
|IP|104.20.67.143||
|IP|104.20.68.143||
|IP|13.107.4.50||
|Clé publique|-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyH5WquT1lubJInFX8PHe\nUztSpYWO2f3Qe7VkgEjfPBu4k43rJbZqzo83laJMPrLSbUYm+PHolwnfO1+dCYtW\n7TqVWYMZf9NYmNxnA/s+CmB/hyEyabbvfpzOAcp0Pv/xhX4qPSnvhPX20lF/7Nm3\nXpmgcNtAopFDQzJP6WCFWxmP5qWVwy9z2f5b3Js5AyZu0aPSADXTloaAcAsUHLsH\nz3lVRUOGXVj7uVJdCxypAOraZWejSqa3qIv6r0cfalG585z2zhY1OfuvIUXwp7jh\ncaA+DzYvEIrda/csgyUdpxNnkJl0q1mPqC15/h6fOWUXTi81jzYID7shFgaAcLmo\nWQIDAQAB\n-----END PUBLIC KEY-----||
|Clé privé|Clé privée récupérée depuis l’URL pastebin||
|Données chiffrées|Contenu de « Documents/Secret/ »||

## 4.  Informations techniques du malware

|   |   |   |   |
|---|---|---|---|
|**Nom du malware**|**Type de malware**|**HASH MD5**|**Objectif visé**|
|Svchost.exe|Ransomware|9b0ba3738c994d5850d97077d578d3bc|Chiffrement des données|


## 5.  Etude du ransomware

Le ransomware écrit en python se présente comme ci-dessous :

![image](https://github.com/user-attachments/assets/2401d0ff-0112-4c3b-8de7-d55cf4f22728)

**Fonction generate_secret_key()**

Cette fonction génère une clé secrète symétrique en utilisant le module Fernet. Cette clé servira à chiffrer les fichiers. Elle renvoie une chaîne de caractères codée en base64.

**Fonction encrypt_secret_key(public_key, secret_key)**

Cette fonction utilise une clé publique pour chiffrer la clé secrète symétrique avec RSA en utilisant le padding OAEP (Optimal Asymmetric Encryption Padding) et l’algorithme de hachage SHA-256.

Le résultat est ensuite encodé en base64 et retourné.

![image](https://github.com/user-attachments/assets/4a245a69-2716-4fff-888f-34f67d23dfac)

**Fonction encrypt_file(file, public_key)**

1.      Génération de la clé secrète : Appelle la fonction generate_secret_key() pour obtenir une clé symétrique.

2.      Chiffrement de la clé secrète : Appelle encrypt_secret_key(public_key, key) pour chiffrer la clé secrète avec la clé publique RSA.

3.      Chiffrement des données du fichier :

    a.       Ouvre le fichier en mode binaire (rb).

    b.       Lit son contenu.

    c.       Utilise la clé symétrique Fernet pour chiffrer le contenu du fichier.

4.      Écriture des données chiffrées :

  a.       Réécrit le fichier avec les données chiffrées.

  b.       Ajoute un marqueur (b'esd_issou_esd') à la fin du fichier pour identifier qu’il a été chiffré.

  c.       Ajoute également la clé secrète chiffrée à la fin du fichier.

5.      Renommage du fichier : Le fichier est renommé avec l'extension .encrypted.

6.      En cas d'erreur, un message d'erreur est ajouté à la liste errors (par exemple, si le fichier est verrouillé en lecture seule).  

![image](https://github.com/user-attachments/assets/c393ddab-21c0-4095-b854-b984efeb7fc5)

1.      Définition de la clé publique utilisée pour le chiffrement RSA.

2.      Téléchargement de la clé privée depuis l’URL [https://pastebin.com/raw/DY2WgpGe](https://pastebin.com/raw/DY2WgpGe) (Toutefois, cette clé n’est pas utilisée directement dans le script.)

3.      Une liste des extensions de fichiers que le malware ciblera pour le chiffrement est définie.

4.      Le script cible un dossier particulier, Secret, situé dans le répertoire Documents de l’utilisateur.

5.      Bien que le script ne semble pas explicitement créer de note de rançon, une variable ransom_note_name est définie.

6.      Après avoir chiffré tous les fichiers, le script entre dans une boucle infinie.

Le script montre un comportement typique d'un ransomware, ciblant les fichiers sensibles et les bloquant avec un chiffrement symétrique.

  

## 6.  TTP du malware

|   |   |   |   |   |   |
|---|---|---|---|---|---|
|**Exécution -**<br><br>**TA0002**|**Privilege Escalation -**<br><br>**TA0004**|**Defense Evasion -**<br><br>**TA0005**|**Discovery -**<br><br>**TA0007**|**Collection -**<br><br>**TA0009**|**Command and Control -**<br><br>**TA0011**|
|Command and Scripting Interpréter -<br><br>T1059|Process Injection -<br><br>T1055|Obfuscated Files or Information -<br><br>T1027|Remote System Discovery -<br><br>T1018|Archive Collected Data -<br><br>T1560|Application Layer Protocol -<br><br>T1071|
|Shared Modules -<br><br>T1129||Process Injection -<br><br>T1055|System Information Discovery -<br><br>T1082||Non-Application Layer Protocol -<br><br>T1095|
|||System Checks -<br><br>T1497.001|File and Directory Discovery -<br><br>T1083||Web Service -<br><br>T1102|
||||System Checks<br><br>T1497.001 -||Encrypted Channel -<br><br>T1573|
||||Security Software Discovery -<br><br>T1518.001|||

  

  

## 7.  Plan d’actions correctives

La mise en œuvre du plan d’actions suivant permettra d’empêcher la situation de se reproduire.

1.      Bloquer et surveiller les IP et domaines malveillants identifiés :

- Les bloquer dans le firewall.

- Les bloquer dans le proxy

- Surveiller les flux vers ces IP / domaines.

2.      Limiter les permissions et protéger les fichiers sensibles, retirer les droits d’écriture empêche le ransomware de fonctionner.

3.      Mettre en place une solution comme **AppLocker** (Windows) pour limiter les programmes exécutables uniquement à ceux qui sont autorisés.

4.      Assurer des sauvegardes régulières pour permettre une récupération rapide en cas d’attaque.

5.      Former les utilisateurs aux bonnes pratiques de sécurité pour réduire les risques d'exécution du malware.
