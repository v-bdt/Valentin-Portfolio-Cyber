

> [!tip]
> Analyse du fichier sans le lancer


# 1. Identifier le type de fichier (Magic Number)

MZ = exécutable

## Sous Linux

```bash
file program
```

```bash
hexdump -C -n 120 program
```




# 2. Rechercher et extraire les différents fichiers embarqués

## Sous Linux

### Binutils #Binwalk

Rechercher les signatures de fichiers communes 

```bash
binwalk -B program
```

Calculer l'entropie du fichier

```bash
binwalk -E program
```

Extraire tous les fichiers embarqués

```bash
binwalk -e program
```

Extraire un type de fichier

```bash
binwalk -D 'XZ' program
```


# 3. Rechercher et extraire les chaines ASCII et Unicode

Permet d'identifier des éléments tels que les noms de domaines, url, ip, dll, syscalls, clés de chiffrement...
## Sous Linux

### Strings

```bash
strings program > strings.txt
```

Chaines ASCII et encodés en Little Endian UTF16

```bash
strings -a -el program > stringsUTF16.txt
```


# 4. Règles YARA

Règles basées sur la signature.

https://github.com/Yara-Rules/rules/tree/master

Analyse des fichiers exécutables de manière récursive dans un répertoire et affiche les correspondances avec un fichier de règle.

```bash
yara rule.yar -rs dir/
```




---


# ANALYSE DE #MALDOC


## PDF

### 1. Afficher les objets du pdf de manière sommaire

***Peepdf*** https://github.com/jesparza/peepdf

```bash
python2 peepdf.py fichier.pdf
```

### 2. Detecter et extraire du code malicieux

***Pdf parser***

```bash
pdf-parser --search javascript fichier.pdf
```

### 3. Extraire tous les objets du pdf

***Origami***

```bash
sudo apt install origami-pdf
```

```bash
pdfextract fichier.pdf
```

### 4. Afficher les métadonnées

***Origami***

```bash
pdfmetadata fichier.pdf
```


## DOCUMENTS OFFICE

![[Pasted image 20250329213250.png]]

Macros -> .docm, .xlsm, .pptm...

### Suite Oletools

```bash
pip install oletools --break-system-packages
```

Oledump -> https://github.com/DidierStevens/DidierStevensSuite/blob/master/oledump.py

### 1. Extraire les macros du document

```bash
oledump fichier.docm
```

### 2. Verifier si le fichier contient des éléments suspects

```bash
olevba fichier.docm
```

### 3. [[DEOBFUSCATION - OBFUSCATION]]





---


# ANALYSE DE #PE

> [!TIP]
> Fichiers compilés en langage machine

## Format du PE

![[Pasted image 20250329220158.png]]

![[Pasted image 20250329220251.png]]

### Sections

![[Pasted image 20250329220419.png]]


#### Section IDATA

Contient le nom des DLL et leur API importés par le binaire

API windows utilisées par les attaquants -> [MalAPI.io](https://malapi.io/)

![[Pasted image 20250329220858.png]]

## 1. Analyse générale

### Sous Windows

PEStudio https://www.winitor.com/download

PEid

### Sous Linux

PEScanner https://github.com/hiddenillusion/AnalyzePE/blob/master/pescanner.py


## 2. Detection de packing

> [!tip]
> UPX ?
> Entropy elevé ?
> Section ayant une taille de 0 octet ?

### Sous Windows

PEStudio

PEid

### Sous Linux

```bash
objdump -h pe.exe
```

```bash
pescanner.py pe.exe
```

```bash
peframe.py pe.exe
```

