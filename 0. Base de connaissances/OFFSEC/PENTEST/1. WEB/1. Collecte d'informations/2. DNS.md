
## **Host file location** #DNS

### *Windows*

```
C:\Windows\System32\drivers\etc\hosts
```
### *Linux*

```
/etc/hosts
```


# **Enregistrements DNS**

### **Types d'enregistrements DNS**

| Record Type | Full Name                 | Description                                                                                                                                 | Zone File Example                                                                              |
| ----------- | ------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------- |
| `A`         | Address Record            | Maps a hostname to its IPv4 address.                                                                                                        | `www.example.com.` IN A `192.0.2.1`                                                            |
| `AAAA`      | IPv6 Address Record       | Maps a hostname to its IPv6 address.                                                                                                        | `www.example.com.` IN AAAA `2001:db8:85a3::8a2e:370:7334`                                      |
| `CNAME`     | Canonical Name Record     | Creates an alias for a hostname, pointing it to another hostname.                                                                           | `blog.example.com.` IN CNAME `webserver.example.net.`                                          |
| `MX`        | Mail Exchange Record      | Specifies the mail server(s) responsible for handling email for the domain.                                                                 | `example.com.` IN MX 10 `mail.example.com.`                                                    |
| `NS`        | Name Server Record        | Delegates a DNS zone to a specific authoritative name server.                                                                               | `example.com.` IN NS `ns1.example.com.`                                                        |
| `TXT`       | Text Record               | Stores arbitrary text information, often used for domain verification or security policies.                                                 | `example.com.` IN TXT `"v=spf1 mx -all"` (SPF record)                                          |
| `SOA`       | Start of Authority Record | Specifies administrative information about a DNS zone, including the primary name server, responsible person's email, and other parameters. | `example.com.` IN SOA `ns1.example.com. admin.example.com. 2024060301 10800 3600 604800 86400` |
| `SRV`       | Service Record            | Defines the hostname and port number for specific services.                                                                                 | `_sip._udp.example.com.` IN SRV 10 5 5060 `sipserver.example.com.`                             |
| `PTR`       | Pointer Record            | Used for reverse DNS lookups, mapping an IP address to a hostname.                                                                          | `1.2.0.192.in-addr.arpa.` IN PTR `www.example.com.`                                            |
## *dig*

Dropper tous les enregistrements DNS

```bash
dig ANY <domain>
```

Dropper les alias DNS

```bash
dig CNAME <domain>
```

Récupérer adresse IPv4 d'un domaine

```bash
dig <domain>
```

Récupérer un type d'enregistrement particulier d'un domaine

```bash
dig <domain> <type>
```

Spécifier le serveur DNS sur lequel faire la requête

```bash
dig @8.8.8.8 <domain>
```

Récupérer DNS d'une @IP

```bash
dig -x 192.168.1.1
```

N'afficher que la section réponse  de la requête

```bash
dig +noall +answer <domain>
```

---
# **SOUS-DOMAINES

## **Enumération active**


### **Transfert de Zone**

#### Sans domaine

```bash
dig axfr @<DNS_IP>
```

#### Avec domaine

```bash
dig axfr @<DNS_IP> <DOMAIN>
```

```bash
fierce --domain <DOMAIN> --dns-servers <DNS_IP> #Will try to perform a zone transfer against every authoritative name server and if this doesn'twork, will launch a dictionary attack
```


### **Bruteforce de sous-domaines (si transfert de zone impossible)**

#### *DNSEnum*

Bruteforce récursif de sous-domaine (sous-domaines des sous domaines identifiés)

```bash
dnsenum --enum inlanefreight.com --dnsserver 10.129.14.128 -f /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -r
```

#### *Subbrute*

https://github.com/TheRook/subbrute.git

```shell
git clone https://github.com/TheRook/subbrute.git
```

```shell
cd subbrute
```

```shell
echo "<IP DNS SERVER ou ns.domain>" > ./resolvers.txt
```

```shell
./subbrute.py inlanefreight.com -s ./names.txt -r ./resolvers.txt
```

#### *Script bash*

```bash
for sub in $(cat /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt);do dig $sub.inlanefreight.htb @10.129.14.128 | grep -v ';\|SOA' | sed -r '/^\s*$/d' | grep $sub | tee -a subdomains.txt;done
```


### **VHOSTS**

Bruteforce de virtual hosts (penser à re-scan pour chaque vhost découvert)

#### *ffuf*

```bash
ffuf -u http://sightless.htb/ -H "Host:FUZZ.sightless.htb" -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
```

#### *Gobuster*

```bash
gobuster vhost -u http://<target_IP_address> -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --append-domain
```

---
## **Enumération Passive**

### *Host*

```shell
host -t ANY inlanefreight.com
```

### *Nslookup*

```shell
nslookup support.inlanefreight.com
```


https://lookup.icann.org/en

https://www.domaintools.com/

### Serveurs MX

https://mxtoolbox.com/

### *Dns Dumpster*

https://dnsdumpster.com/

### *Subfinder*

https://github.com/projectdiscovery/subfinder.git

```sh
./subfinder -d inlanefreight.com -v
```

### *Google dorks*

```
site:<domain>
```

### *CT Logs*

Logs d'attribution des certificats de transparence SSL/TLS

https://search.censys.io/
https://crt.sh/

```bash
curl -s "https://crt.sh/?q=facebook.com&output=json" | jq -r '.[]
 | select(.name_value | contains("dev")) | .name_value' | sort -u
```

### *Shodan*

Récupérer les dns grâce aux CT logs

```bash
curl -s "https://crt.sh/?q=facebook.com&output=json" | jq -r '.[]
 | select(.name_value | contains("")) | .name_value' | sort -u > subdomainlist
```

Trier ceux accessible directement depuis internet 

```bash
for i in $(cat subdomainlist);do host $i | grep "has address" | grep facebook.com | cut -d" " -f1,4;done
```

Récupérer les IP associées

```bash
for i in $(cat subdomainlist);do host $i | grep "has address" | grep facebook.com | cut -d" " -f4 >> ip-addresses.txt;done
```

Scan de chaque IP avec Shodan (Nécessite API)

```bash
for i in $(cat ip-addresses.txt);do shodan host $i;done
```



---

## **Domain / Subdomain TakeOver**

Consiste à enregistrer le domaine ou sous-domaine cible lorsqu'il expire pour en prendre le contrôle.

https://github.com/EdOverflow/can-i-take-over-xyz
