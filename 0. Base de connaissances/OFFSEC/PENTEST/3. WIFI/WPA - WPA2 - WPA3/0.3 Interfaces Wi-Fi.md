
[[#Prérequis]]
[[#Installation des drivers]]
[[#Ajustement de la carte Wi-Fi]]
[[#Check des capacités de la carte]]
[[#Scanner les réseaux disponibles]]
[[#Changer le channel et la fréquence de la carte]]
[[#Interface Modes]]


---
# Prérequis

> [!ATTENTION]
> Pour que ça soit fonctionnel dans VM -> USB compatibility 3.1 dans les paramètres de la VM


1. Doit supporter le 5Ghz
2. Doit supporter 802.11ac ou 802.11ax
3. Doit supporter le mode monitor et l'injection de paquets
4. Doit supporter SAE pour WPA3

---
# Installation des drivers

https://docs.alfa.com.tw/Support/Kali_Linux/Running_Kali_Linux_in_VirtualBox/

```
sudo apt update
sudo apt upgrade
sudo apt install -y realtek-rtl88xxau-dkms
git clone https://github.com/lwfinger/rtw88
cd rtw88
make
sudo make install
sudo make install_fw
sudo cp rtw88.conf /etc/modprobe.d/
```

Puis reboot

check des drivers

```
$ lsmod | grep 88
88XXau               2289664  0
snd_seq_dummy          12288  0
snd_hrtimer            12288  1
rtw_8812au             12288  0
rtw_8812a              53248  1 rtw_8812au
rtw_88xxa              45056  1 rtw_8812a
rtw_usb                32768  1 rtw_8812au
rtw_core              315392  3 rtw_88xxa,rtw_usb,rtw_8812a
```

---
# Ajustement de la carte Wi-Fi

Voir config de la carte

```
iwconfig
```


Identifier le pays associé et les dBm maximum associés.

```
iw reg get
```

Changer le pays associé

```shell-session
sudo iw reg set US
```


Augmenter le tx-power si nécessaire (attention aux lois du pays)

```shell-session
sudo ifconfig wlan0 down
sudo iwconfig wlan0 txpower 30
sudo ifconfig wlan0 up
```

---

# Check des capacités de la carte

```shell-session
iw list
```

---

# Scanner les réseaux disponibles

```shell-session
sudo iwlist wlan0 scan |  grep 'Cell\|Quality\|ESSID\|IEEE'
```


---

# Changer le channel et la fréquence de la carte


> [!TIP]
> Optimiser les performances de la carte

### Changer de channel

identifier les channels disponibles

```shell-session
iwlist wlan0 channel
```

Désactiver l'interface

```shell-session
sudo ifconfig wlan0 down
```

Changer le channel

```
sudo iwconfig wlan0 channel 64
```

Activer l'interface

```
sudo ifconfig wlan0 up
```

Check du current channel

```
iwlist wlan0 channel
```

### Changer de fréquence

Afficher la frequence actuel

```shell-session
iwlist wlan0 frequency | grep Current
```

Désactiver l'interface

```shell-session
sudo ifconfig wlan0 down
```

Changer la fréquence

```
sudo iwconfig wlan0 freq "5.52G"
```

Activer l'interface

```
sudo ifconfig wlan0 up
```

Afficher la frequence actuel

```shell-session
iwlist wlan0 frequency | grep Current
```


----

# Interface Modes

modes disponibles :

1. Managed -> Mode par défaut Accès client/AP.
2. Ad-Hoc -> Permet de relier plusieurs cartes wifi entre elles. AP 2 AP.
3. Master -> Permet de passer la carte en mode Point d'Accès. -> Evil-Twin / Rogue AP
4. Mesh -> Point d'accès à large couverture.
5. MONITOR / PROMISCUOUS -> Permet de capturer tout le trafic. -> Capture des challenge/response.


## Managed

Désactiver la carte

```shell-session
sudo ifconfig wlan0 down
```

Passer en mode Managed

```shell-session
sudo iwconfig wlan0 mode managed
```

Activer la carte

```shell-session
sudo ifconfig wlan0 up
```

Se connecter à un AP

```shell-session
sudo iwconfig wlan0 essid HTB-Wifi
```

Vérifier la conf

```shell-session
sudo iwconfig
```


## Ad-Hoc

> [!TIP]
> Utile pour exploitation de Backhaul et Mesh (Permet l'usurpation de node)


```shell-session
sudo ifconfig wlan0 down
```

```shell-session
sudo iwconfig wlan0 mode ad-hoc
```

```shell-session
sudo ifconfig wlan0 up
```

```shell-session
sudo iwconfig wlan0 essid HTB-Mesh
```

```shell-session
sudo iwconfig
```


## Master

> [!WARNING]
> Necessaire pour Evil-Twin attack ou Rogue AP

> [!TIP]
> Nécessite de faire tourner un "Management daemon" afin de répondre aux clients qui souhaitent s'authentifier

Créer fichier open.conf

```shell-session
vim open.conf

interface=wlan0
driver=nl80211
ssid=HTB-Hello-World
channel=2
hw_mode=g
```

Lancer le mode master avec le fichier conf

```shell-session
sudo hostapd open.conf
```


## Mesh


```shell-session
sudo iw dev wlan0 set type mesh
```


## Monitor / Promiscuous

> [!WARNING]
> Necessaire à tout type d'attaque

```shell-session
sudo ifconfig wlan0 down
```

```shell-session
sudo iw wlan0 set monitor control
```

```shell-session
sudo ifconfig wlan0 up
```

```shell-session
iwconfig
```