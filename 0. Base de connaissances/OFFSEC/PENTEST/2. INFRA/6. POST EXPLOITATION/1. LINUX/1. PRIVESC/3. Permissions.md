
- [ ] [[#Sudo Rights Abuse]]
- [ ] [[#Privileged Groups]]
- [ ] [[#Capabilities]]
- [ ] [[#PkExec as root]]
- [ ] [[#SUID / SGID -> GTFOBINS]]


---
# Sudo Rights Abuse

> [!TIP]
> Si programme lancé en sudo sans chemin absolu -> hijacking du programme

Check si possible d'exploiter un programme avec la commande sudo -> GTFOBINS

```bash
sudo -l
```

```sh
man <programme>
```

Wildcard

> [!TIP]
> Si ``*`` dans le path du droit sudo (ex:  ``/bin/cat /challenge/app-script/ch1/notes/*``)
> Possible de ../../../ pour aller chercher un fichier.

---

# Privileged Groups

- [[#LXC / LXD]]
- [[#DOCKER]]
- [[#DISK]]
- [[#ADM]]

## LXC / LXD

> [!tip]
> Si LXD/LXC installé (manager de conteneurs) -> Tous les users dans le groupe LXD par défaut peuvent monter conteneur en root


```shell
getent group lxd
```

[[4. Services#LXC / LXD]]


## DOCKER

> [!tip]
> Si Docker installé (manager de conteneurs) -> Tous les users dans le groupe Docker par défaut peuvent monter conteneur en root
> 

```shell
getent group docker
```

[[4. Services#DOCKER#Docker Group]]


## DISK

> [!tip]
> Accès complet aux appareils dans /dev, comme /dev/sda1


```shell
getent group disk
```


1. identifier le point de montage de /

```
df -h
```

2. Debugfs

```
debugfs /dev/sda1
```

3. Naviguer sur le FS

```
cd /root
```
...


## ADM

> [!tip]
> Possible de lire tous les logs dans /var/log

```shell
getent group adm
```


Chercher des mots de passe dans les logs.

```
egrep -ri 'pass' /var/log
```

```shell
for i in $(ls /var/log/* 2>/dev/null);do GREP=$(grep "accepted\|session opened\|session closed\|failure\|failed\|ssh\|password changed\|new user\|delete user\|sudo\|COMMAND\=\|logs" $i 2>/dev/null); if [[ $GREP ]];then echo -e "\n#### Log file: " $i; grep "accepted\|session opened\|session closed\|failure\|failed\|ssh\|password changed\|new user\|delete user\|sudo\|COMMAND\=\|logs" $i 2>/dev/null;fi;done
```


si auditd installé et fichier /var/log/audit/audit.log présent

```
aureport --tty | grep <user> -C 5
```

```
aureport --tty | less
```




---
# Capabilities

Check si possible d'exploiter les capabilities (cap_setuid, cap_setgid, cap_sys_admin, cap_dac_override)

```bash
find /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin -type f -exec getcap {} \;
```

CAP_SYS_ADMIN -> https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/linux-capabilities.html?highlight=cap#cap_sys_admin

CAP_SETUID -> https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/linux-capabilities.html?highlight=cap#cap_setuid

CAP_SETGID -> https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/linux-capabilities.html?highlight=cap#cap_setgid

CAP_DAC_OVERRIDE -> https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/linux-capabilities.html?highlight=cap#cap_dac_override


---
# PkExec as root


```bash
pkexec -u root /bin/bash
```


---

# SUID / SGID -> GTFOBINS

```bash
ls -la `find / -perm /u=s,g=s -type f 2>/dev/null`
```

