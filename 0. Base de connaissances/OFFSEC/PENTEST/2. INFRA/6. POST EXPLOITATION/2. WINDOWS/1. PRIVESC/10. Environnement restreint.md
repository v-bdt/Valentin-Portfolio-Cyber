
https://node-security.com/posts/breaking-out-of-windows-environments/
https://www.pentestpartners.com/security-blog/breaking-out-of-citrix-and-other-restricted-desktop-environments/


- [[#Citrix Breakout]]
- [[#Privesc]]
- [[#Bypassing UAC]]


---

# Citrix Breakout

- [ ] [[#Bypassing Path Restrictions]]
- [ ] [[#Bypass de restrictions sur l'explorateur de fichiers]]
- [ ] [[#Bypass Registry Editor restrictions]]
- [ ] [[#Modifier path d'un shortcut]]
- [ ] [[#Bypass CMD / Powershell restriction]]
- [ ] [[#Script Execution]]



Méthodologie de base pour le breeakout :

1. Obtenir l'accès à une « boîte de dialogue ».
2. Exploiter la boîte de dialogue pour obtenir l'exécution d'une commande.
3. escalade des privilèges pour obtenir des niveaux d'accès plus élevés.

## Bypassing Path Restrictions


Depuis une application permettant d'ouvrir ou sauvegarder des fichiers 

1. Cliquer sur "Ouvrir" ou "Enregistrer Sous"
2. Préciser "Tous les fichiers"
3. Entrer  dans File Name 

```
 \\127.0.0.1\c$\users\pmorgan
```

Pour accéder à un cmd

```
\\127.0.0.1\c$\Windows\System32
```

Clique droit sur cmd.exe -> Ouvrir

Ou bien directement depuis le Path -> cmd.exe


## Bypass de restrictions sur l'explorateur de fichiers

https://explorerplusplus.com/


## Bypass Registry Editor restrictions

https://sourceforge.net/projects/simpregedit/
https://sourceforge.net/projects/uberregedit/
https://sourceforge.net/projects/sre/


## Modifier path d'un shortcut

Clique droit sur le shortcut -> Propriétés
modifier la target -> C:\Windows\System32\cmd.exe


## Bypass CMD / Powershell restriction

depuis un path ou win +r 

```
cmd.exe /k "whoami"
```

```
powershell -c "powershell"
```

## Script Execution

Créer un script afin d'éxecuter des commandes

1. Créez un nouveau fichier texte et nommez-le « evil.bat ».
2. Ouvrez le fichier « evil.bat » avec un éditeur de texte tel que Notepad.
3. Saisissez la commande "cmd" dans le fichier.
4. Sauvegarder et exécuter le fichier


---
# Privesc


Une fois l'accès à un cmd ou powershell, lancer les tools / commandes pour identifier les privesc.

```powershell
Set-ExecutionPolicy Bypass -Scope Process
```


---
# Bypassing UAC

Necessite de faire parti du groupe administrators local

[[6. UAC - Services - Registry - DLL Attacks#UAC Bypass]]

#### Script Bypass-UAC (WIN7/10)

https://github.com/FuzzySecurity/PowerShell-Suite/tree/master/Bypass-UAC

```powershell
Import-Module .\Bypass-UAC.ps1
```

```powershell
Bypass-UAC -Method UacMethodSysprep
```