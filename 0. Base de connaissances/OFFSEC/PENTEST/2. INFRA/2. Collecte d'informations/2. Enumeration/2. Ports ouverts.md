
> [!OBJECTIF]
> Identifier les ports ouverts sur la machine / réseau cible

> [!TIP]
> Scanner la cible sur l'interface ipv6 si possible 

> [!TIP]
> Scanner par tranches de ports (0-1024 / 1025-65535)

# #TTL

![[Pasted image 20250312011933.png]]
# **NMAP**

Scripts

| **Category** | **Description**                                                                                                                         |
| ------------ | --------------------------------------------------------------------------------------------------------------------------------------- |
| `auth`       | Determination of authentication credentials.                                                                                            |
| `broadcast`  | Scripts, which are used for host discovery by broadcasting and the discovered hosts, can be automatically added to the remaining scans. |
| `brute`      | Executes scripts that try to log in to the respective service by brute-forcing with credentials.                                        |
| `default`    | Default scripts executed by using the `-sC` option.                                                                                     |
| `discovery`  | Evaluation of accessible services.                                                                                                      |
| `dos`        | These scripts are used to check services for denial of service vulnerabilities and are used less as it harms the services.              |
| `exploit`    | This category of scripts tries to exploit known vulnerabilities for the scanned port.                                                   |
| `external`   | Scripts that use external services for further processing.                                                                              |
| `fuzzer`     | This uses scripts to identify vulnerabilities and unexpected packet handling by sending different fields, which can take much time.     |
| `intrusive`  | Intrusive scripts that could negatively affect the target system.                                                                       |
| `malware`    | Checks if some malware infects the target system.                                                                                       |
| `safe`       | Defensive scripts that do not perform intrusive and destructive access.                                                                 |
| `version`    | Extension for service detection.                                                                                                        |
| `vuln`       | Identification of specific vulnerabilities.                                                                                             |

Chercher scripts

```bash
find / -type f -name ftp* 2>/dev/null | grep scripts
```

---
## *Scans classiques (Pas d'IDS/IPS/Firewall)*


### Scan discret des 100 ports les plus utilisés ainsi que la version des services et l'utilisation des scripts par défaut

#### #TCP

```bash
nmap -sS -sV -sC -F -vv <ip> -oA nmapTCP-F
```
#### #UDP

```bash
nmap -sU -sV -sC -F -vv <ip> -oA nmapUDP-F
```

### Scan discret des ports et versions de services de 0 à 1024

#### #TCP 

```bash
nmap -sS -sV -sC -p 0-1024 -vv <ip> -oA nmapTCP-0-1024
```

#### #UDP 

```bash
nmap -sU -sV -sC -p 0-1024 -vv <ip> -oA nmapUDP-0-1024
```

### Scan discret des ports et versions de services de 1024 à 65535

#### #TCP 

```bash
nmap -sS -sV -sC -p 1024-65535 -vv <ip> -oA nmapTCP-1024-65535
```

#### #UDP 

```bash
nmap -sU -sV -sC -p 1024-65535 -vv <ip> -oA nmapUDP-1024-65535
```

### Scan ultra agressif et très bruyant de tous les ports (rapide)

#### #TCP 

```bash
nmap -A -T5 -sC -p- -vv <ip> -oA nmapTCPFULL
```

#### #UDP 

```bash
nmap -sU -A -T5 -sC -p- -vv --max-retries 1 <ip> -oA nmapUDPFULL
```


---
## *Scan IDS/IPS/Firewall Evasion*

> [!TIP]
> Scanner par tranches de ports (0-1024 / 1025-65535)

### Flag ACK (empêche au firewall de déterminer si la requête vient du réseau interne ou externe) -> si RCVD n'indique pas unreachable -> port ouvert

```bash
nmap -p <ports> -sA -Pn -n -vv --disable-arp-ping --packet-trace <ip>
```

### Générer 5 ip random

```bash
nmap -p <ports> -sS -Pn -n --disable-arp-ping --packet-trace -vv -D RND:5 <ip>
```

### Préciser une IP source différente pour le scan (necessite de contrôler l'ip pour avoir une reponse)

```bash
nmap -n -Pn -p <port> -e <interface> -S <ip_source> -vv <ip>
```

### Préciser un port source différent pour le scan (Tester port 53)

```bash
nmap -p <tranche de ports> -sS --source-port <port> -vv <ip>
```

### Préciser un serveur dns différent pour le scan (Utile dans DMZ)

```bash
nmap -p <tranche de ports> -sS --dns-server <ns> -vv <ip>
```



---
## *Scan en passant par TOR*


```bash
proxychains4 -f /etc/proxychains4.conf -sT -Pn -n -p <ports> -vv <ip>
```


---


# **TCPDUMP / NC** #BannerGrabbing

>[!TIP]
>Si Version du service non trouvé avec NMAP, possibilité de récupérer les banner avec tcpdump et nc

## Intercepter le traffic avec TCPDump

```bash
sudo tcpdump -i <int> host <monip> and <ipcible>
```

## Etablir une connexion avec la cible (patience...)

```bash
nc -nv -p <port source> <ip> <port>
```