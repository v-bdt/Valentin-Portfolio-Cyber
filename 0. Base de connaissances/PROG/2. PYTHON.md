
https://www.w3schools.com/python/

[[#VENV]]
[[#SheBang]]
[[#Variables]]
[[#Arguments]]
[[#List, Tuple, Set & Dictionary]] (Arrays)
[[#Structure conditionnelles & Boucles]]
[[#Fonctions]]
[[#Classes]]
[[#Librairies]]
[[#Main Block]]


# VENV

> [!TIP]
> Permet de créer un environnement virtuel afin d'installer des versions de modules différentes sans écraser celles sur le système

Préparer l'environnement virtuel

```shell
python3 -m venv <env_name>
```

Sourcer l'environnement

```shell
source <env_name>/bin/activate
```

Installer un package

```shell
pip install requests
```





# SheBang

```python
#!/usr/bin/env python3
```

---
# Variables

Convention de nommage -> convention_de_nommage.

[[#Types de variables]]
[[#Afficher contenu d'une variable]]
[[#Concaténer les variables]]
[[#Combiner les variables]]

## Types de variables

> [!TIP]
> Pas besoin de déclarer le type de variables. 

```python
int = 42
string_simple_quote = 'string'
string_double_quote = "string"
multiplication = 7 * 6
format_string = f'The meaning of life might be {multiplication}.'  # -> The meaning of life might be 42. (Python >= 3.6)
boolean = True / False / None #(équivalent à null)
list = ['Walnuts', 'Grapes', 'Bird seeds']
# Commentaires
```

## Afficher contenu d'une variable

```python
print(string)
```

## Concaténer les variables

```python
print(string, int, multiplication, boolean)
```

## Combiner les variables

```python
add = 10 + 10
sub = 20 - 10
multi = 5 * 5
div = 10 / 5


result = (add * sub) - (multi * div)		# (20 * 10) - (25 * 2)
print('Result: ', result) # -> Result:  150
```

---
# Arguments

> [!TIP]
> Possible d'utiliser le module CLICK pour la gestion des arguments

https://click.palletsprojects.com/en/stable/

```python
import click

@click.command()
@click.option('--count', default=1, help='Number of greetings.')
@click.option('--name', prompt='Your name', help='The person to greet.')
def hello(count, name):
    for i in range(count):
        click.echo('Hello %s!' % name)

if __name__ == '__main__':
    hello()
```

```sh
$ python click_test.py --name Birb --count 3
Hello Birb!
Hello Birb!
Hello Birb!
```


---
# List, Tuple, Set & Dictionary

[[#List]]
[[#Tuple]]
[[#Set]]
[[#Dictionary]]

[[#Indexage]]
[[#Substrings]]


## List

Permet de stocker plusieurs valeurs dans une variable -> Modifiable à souhait et permet les duplicatas, s'affiche dans l'ordre

```python
list = ['Walnuts', 'Grapes', 'Bird seeds']
```

## Tuple

Permet de stocker plusieurs valeurs dans une variable -> Non modifiable et permet les duplicatas, s'affiche dans l'ordre

```python
thistuple = ("apple", "banana", "cherry")
```

## Set 

Permet de stocker plusieurs valeurs dans une variable -> Non modifiable mais possible de supprimer ou ajouter une valeur du set. Ne s'affiche pas dans l'ordre. Ne permet pas les duplicatas

```python
thisset = {"apple", "banana", "cherry"}
```

## Dictionary

Permet de stocker plusieurs valeurs dans une variable  sous forme de paire key:value. Modifiable et n'autorise pas les duplicatas.
Python >= 3.7 -> s'affiche dans l'ordre
Python <= 3.6 -> s'affiche dans le désordre

```python
thisdict = {  
  "brand": "Ford",  
  "model": "Mustang",  
  "year": 1964  
}
```


###  Indexage

```python
var = "ABCDEF"
print(var[0], var[1], var[2], var[3], var[4], var[5]) # A B C D E F
print(var[-1], var[-2], var[-3], var[-4], var[-5], var[-6]) # F E D C B A
```

|**Negative Index**|**Index**|**Character**|
|---|---|---|
|`-6`|`0`|A|
|`-5`|`1`|B|
|`-4`|`2`|C|
|`-3`|`3`|D|
|`-2`|`4`|E|
|`-1`|`5`|F|

### Substrings

```python
var = "ABCDEF"
print(var[:2])	# Up to index 2
AB
print(var[2:])	# Ignore everything up to index 2
CDEF
print(var[2:4])	# Everything between index 2 and 4 ("2" is counted)
CD
print(var[-2:])	# Up to negative index 2 (last two characters)
EF
```


---

# Structure conditionnelles & Boucles

[[#if, elif, else]]
[[#Boucle While]]
[[#Boucle For-Each]]

## if, elif, else

```python
happy = 2

if happy == 1:
    print("Happy and we know it!")
elif happy == 2:
    print("Excited about it!")
else:
    print("Not happy...")
```

```python
happy = True

if happy:
	print("Happy and we know it!")
else:
    print("Not happy...")
```

## Boucle While

```python
counter = 0

while counter < 5:
    print(f'Hello #{counter}')
    counter = counter + 1
```

## Boucle For-Each

```python
groceries = ['Walnuts', 'Grapes', 'Bird seeds']

for food in groceries:
    print(f'I bought some {food} today.')
```


---

# Fonctions

Fonctions Built-in -> https://docs.python.org/3/library/functions.html

fonction classique

```python
def function(x):
    return 2 * x + 5
```

Puissance_de avec arguments positionnel 

```python
def power_of(x, exponent):
    return x ** exponent
    

print('My favourite number is:', power_of(4, 2)) # My favourite number is: 16
```


Arguments (paramètres) nommés

```python
# Defining the function
def print_sample_invitation(mother, father, child, teacher, event):

    # Notice here the use of a multi-line format-string: f''' text here '''
    sample_text = f'''
Dear {mother} and {father}.
{teacher} and I would love to see you both as well as {child} at our {event} tomorrow evening. 

Best regards,
Principal G. Sturgis.
'''
    # Print output
    print(sample_text)

# Call function
print_sample_invitation(mother='Karen', father='John', child='Noah', teacher='Tina', event='Pizza Party')
```


---

# Classes

La déclaration d'une classe regroupe des membres, méthodes et propriétés (attributs) communs à un ensemble d'objets. La classe déclare, d'une part, des attributs représentant l'état des objets et, d'autre part, des méthodes représentant leur comportement.

## Paramètres de classes

### Self

Paramètre mandataire à toutes les fonctions de la classe, doit apparaitre en premier afin de se référer à sa propre classe.


DreamCake :

```python
class DreamCake:
    # Measurements are defined in grams or units
    eggs = 4
    sugar = 300 
    milk = 200
    butter = 50
    flour = 250
    baking_soda = 20
    vanilla = 10

    topping = None
    garnish = None

    is_baked = False

    def __init__(self, topping='No topping', garnish='No garnish'):
        self.topping = topping
        self.garnish = garnish
    
    def bake(self):
        self.is_baked = True

    def is_cake_ready(self):
        return self.is_baked
```

plain_cake

```python
plain_cake = DreamCake()
```

chocolate_cake

```python
chocolate_cake = DreamCake(topping='Chocolate frosting')
```

luxury_strawberry_cake

```python
luxury_strawberry_cake = DreamCake(topping='Strawberry frosting', garnish='Chocolate bits')
```

Baking the cake

```python
chocolate_cake = DreamCake(topping='Chocolate frosting')

chocolate_cake.bake()  # Call the function "bake" on the object.
is_cake_done = chocolate_cake.is_cake_ready()

print(is_cake_done)  # Prints "True" because we called "bake" earlier
```


## Classe supportant WITH

```python
class Foo():

    def __enter__(self):
        print("Enter...")

    def __exit__(self, type, value, traceback):
        print("...and exit.")
```

Permet d'appeler la classe avec with et d'envelopper avec les fonctions enter et exit présents dans la classe.

```python
with Foo():
    print("Hello world!") 
#Enter...
#Hello world!
#...and exit.
```


---

# Librairies

[[#Importer les Librairies]]
[[#Manager les librairies]]
[[#Librairies importantes]]

## Importer les Librairies

import standard

```python
import datetime

now = datetime.datetime.now()
print(now)  # Prints: 2021-03-11 17:03:48.937590
```

Import d'une classe d'une lib

```python
from datetime import datetime

print(datetime.now())
```

Import d'une classe d'une lib et lui attribuer un nouveau nom

```python
from datetime import datetime as dt

print(dt.now())
```

## Manager les librairies
### PIP

Installer package

```sh
pip install <packages>
```

Installer à partir de fichier de requirements (format ``flask==1.1.2``)

```shell-session
pip install -r requirements.txt
```

Upgrade package

```shell-session
pip install --upgrade <package>
```

Uninstall package

```shell-session
pip uninstall [package]
```

Lister les packages installés

```shell-session
pip freeze
pip list
```

## Librairies importantes

[[#Web]]
[[#Réseau]]
[[#Système]]

[[#Misc]]

### Web

[[#Requests]]
[[#BeautifulSoup]]
#### Requests

https://requests.readthedocs.io/en/latest/

> [!TIP]
> Permet de faire des requêtes HTTP(s) de manière simple 

install

```shell-session
pip install requests
```



```python
import requests

r = requests.get('http://httpbin.org/get') # Requete GET
r = requests.post('http://httpbin.org/post'), data={'key':'value'} # Requete POST
r = requests.put('http://httpbin.org/put'), data={'key':'value'} # Requete PUT
r = requests.delete('http://httpbin.org/delete') # Requete DELETE
r = requests.head('http://httpbin.org/get') # Requete HEAD
r = requests.options('http://httpbin.org/get') # Requete OPTIONS
```

Fonction avec GET request

```python
import requests

PAGE_URL = 'http://target:port'

def get_html_of(url): # Defini la fonction get_html_of
    r = requests.get(url)

    if resp.status_code != 200:
        print(f'HTTP status code of {resp.status_code} returned, but 200 was expected. Exiting...')
        exit(1)

    return resp.content.decode()

print(get_html_of(PAGE_URL))
```


#### BeautifulSoup

https://www.crummy.com/software/BeautifulSoup/bs4/doc/

> [!TIP]
> Permet de mettre en forme du HTML de façon plus lisible.
> Utile pour le crawling et le parsing du DOM

install

```shell-session
pip install beautifulsoup4
```

Pretty Format (Mise en forme élégante)

```python
from bs4 import BeautifulSoup

html_doc = """ html code goes here """
soup = BeautifulSoup(html_doc, 'html.parser')
print(soup.prettify())
```

FindAll (Permet d'obtenir toutes les occurences de la balise recherchée)

```python
from bs4 import BeautifulSoup
import requests

r = requests.get('<url>').text # Requete GET
soup = BeautifulSoup(r, 'html.parser')
h2_tags = soup.find_all('h2') # Renvoi une liste contenant toutes les balises h2
for h2 in h2_tags:
	print(h2)
```


### Réseau

[[#Socket]]
[[#Scapy]]

#### Socket

https://docs.python.org/3/library/socket.html

> [!TIP]
> Permet de manipuler les sockets réseaux TCP/UDP afin d'établir la communication entre client / serveur

Créer un objet socket

```python
import socket

s_tcp = socket.socket(socket.AF_INET, socket.SOCK_STREAM) # Objet socket TCP avec connecteur IPv4
s_udp = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) # Objet socket UDP avec connecteur IPv4
```


Etablir une connexion TCP et échanger des données en tant que client.

```python
import socket

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) # Creation de l'objet socket tcp
s.connect(('<IP>', PORT)) # Etablissement de la connexion avec le serveur
s.send('Hello\n'.encode('utf-8')) # Envoi du message Hello au format utf-8 (bytes par défaut)
data = s.recv(1024) # Reception de la réponse au message envoyé
print(data) # Afficher la réponse
s.close() # Fermeture de la socket
```


Scanner de ports

```python
import socket

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) # Creation de l'objet socket tcp
s.connect_ex(('<IP>', PORT)) # Etablissement de la connexion sur le port cible -> si réponse = 0 alors port ouvert / sinon port fermé.
s.close() # Fermeture de la socket
```


Création d'un serveur TCP/IP

```python
import socket

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) # Creation de l'objet socket tcp
s.bind(('0.0.0.0', PORT)) # Bind de la socket à une interface/port.
s.listen(2) # Listener sur le socket qui autorise 2 tentatives de connexion.

conn, addr = s.accept() # Acceptation de la connexion entrante.
print("Connexion entrante depuis : ", addr[0])

data = conn.recv(1024) # Reception des données.
print(data.decode())

conn.send("Response\n".encode('utf-8')) # Envoi de la réponse.
conn.close() # Fermeture de la connexion.

s.close() # Fermeture de la socket
```


#### Scapy

https://scapy.net/
https://scapy.readthedocs.io/

> [!TIP]
> Permet la manipulation de paquets -> Forge, capture, traitement...


Forge et envoi de paquet TCP/IP Syn

```python
from scapy.all import *

pkt = IP(dst='<IP>')/TCP(dport=<PORT>, flags='S') # Forge du paquet avec flag Syn
send(pkt) # Envoi du paquet

resp = sr1(pkt) # Retour de la reponse
resp.show() # Afficher la reponse au format json
resp.summary() # Affiche la reponse de façon sommaire
```


### Système

[[#Os]]
[[#Subprocess]]

#### Os

> [!TIP]
> Permet d'executer des commandes systèmes

méthode os.system (attend que la commande soit exécutée ce qui peut être bloquant)

```python
import os

cmd = os.system("ls") # Execution de la commande ls
print(cmd) # Affiche le resultat de la commande
```

méthode os.popen()

```python
import os

cmd = os.popen("ls")
print(cmd.read())
```


#### Subprocess

https://www.geeksforgeeks.org/python/python-subprocess-module/

> [!TIP]
> Permet d'exécuter des processus avec des propriétés spécifiques

Lancement d'un processus interactif qui exécute une commande.

```python
import subprocess

process = subprocess.Popen('dir', shell=True, stdout=subprocess.PIPE, stdin=subprocess.PIPE, stderr=subprocess.PIPE) # Lancement d'un processus en arrière plan qui execute la commande dir via cmd.exe, redirige la sortie standard pour qu'on puisse la lire en python, permet d'envoyer des données au processus et redirige la sortie d'erreur.

out = process.stdout.read() # Récupération du résultat de la commande
print (out.decode("iso-8859-2")) # Afficher la résultat de la commande au format ISO-8859-2 au lieu de bytes.

```

### Crypto & Encodage

#### base64

> [!TIP]
> Permet d'encoder et decoder au format base64

base64 decode

```python
import base64

base64_string = "aGVsbG9fd29ybGQ="

decoded_bytes = base64.b64decode(base64_string) # Base64 decode
decoded_str = decoded_bytes.decode("utf-8") # Transformer en string
print(decoded_str)
```

base64 encode

```python
import base64

string = "Hello World"
string_bytes = string.encode('utf-8') # Transformer en bytes
base64_encode = base64.b64encode(string_bytes) # Base64 encode le bytes
base64_string = base64_encode.decode("utf-8") # Transformer le bytes en string
print(base64_string)
```

#### Codecs
https://www.geeksforgeeks.org/python/codecs-decode-in-python/

> [!TIP]
> Permet l'encodage  et decodage sous plusieurs formes

ROT13 decode

```python
import codecs

ROT13_string = "7zO4buwqIZnLaKfkAaUZ8Eg"

decode_ROT13 = codecs.decode(ROT13_string, 'rot_13')
print(decode_ROT13)
```

ROT13 encode

```python
import codecs

string = "Hello World"

encode_string = codecs.encode(string, 'rot_13')
print(encode_string)
```


### Misc

[[#Re]]
[[#Math]]
[[#Zlib]]

#### Re

> [!TIP]
> Module regex qui permet d'extraire n'importe quel élément.

findall afin d'extraire les nombres de la variable message

```python
import re

message = "Calculate the square root of 244 and multiply by 7423 ="

# Extract all numbers from the string
numbers = re.findall(r"\d+", message)

# Assign them to variables
number_1 = int(numbers[0])
number_2 = int(numbers[1])

print("number_1:", number_1)
print("number_2:", number_2)
```

#### Math

https://docs.python.org/fr/3.10/library/math.html

> [!TIP]
> Permet d'effectuer des operations mathématiques


```python
import math

math.sqrt(x) # calcule la racine carrée de x
```

#### Zlib

> [!TIP]
> Permet de compresser et décompresser des données

```python
import zlib

data = b"Hello World" # Data au format bytes

compressed_data = zlib.compress(data) # Compression de data
print(compressed_data)

decompressed_data = zlib.decompress(compressed_data) # Decompression de data
print(decompressed_data.decode()) # print au format utf-8
```

---

# Main Block

> [!TIP]
> Mettre le code à exécuter dans un block main afin d'empêcher son exécution directe en cas d'import

exemple :

```python
if __name__ == '__main__':
    page_url = 'http://target:port'
    the_words = get_all_words_from(page_url)
    top_words = get_top_words_from(the_words)

    for i in range(10):
        print(top_words[i][0])
```